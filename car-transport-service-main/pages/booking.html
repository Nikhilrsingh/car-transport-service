<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book Vehicle Transport - Harihar Car Carriers</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
          crossorigin=""/>
    
    <!-- Leaflet Routing Machine CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.css" />
    
    <!-- Leaflet Control Geocoder CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder@2.4.0/dist/Control.Geocoder.css" />
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "Poppins", sans-serif;
            background-color: #2b2b2b;
            color: white;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Hero Section */
        .booking-hero {
            padding: 150px 0 80px;
            background: linear-gradient(rgba(0, 0, 0, 0.8), rgba(0, 0, 0, 0.8)),
                url('https://images.unsplash.com/photo-1568605117036-5fe5e7bab0b7?ixlib=rb-4.0.3&auto=format&fit=crop&w=2070&q=80');
            background-size: cover;
            background-position: center;
            text-align: center;
        }

        .booking-hero h1 {
            font-size: 3.5rem;
            margin-bottom: 20px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
        }

        .booking-hero p {
            font-size: 1.3rem;
            max-width: 700px;
            margin: 0 auto 30px;
            opacity: 0.9;
        }

        /* Booking Section */
        .booking-section {
            padding: 80px 0;
            background-color: #333;
        }

        .booking-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            align-items: start;
        }

        /* Booking Form */
        .booking-form-container {
            background: linear-gradient(145deg, #2b2b2b, #333);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            border: 1px solid #444;
            position: relative;
        }

        .booking-form-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #ff6347, #ff4500);
        }

        .form-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .form-header h2 {
            font-size: 2rem;
            color: white;
            margin-bottom: 8px;
        }

        .form-header p {
            color: #ff6347;
            font-size: 1rem;
        }

        .booking-form {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .form-group {
            position: relative;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #ccc;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .form-group label i {
            color: #ff6347;
            width: 16px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 15px;
            background: #1a1a1a;
            border: 2px solid #444;
            border-radius: 10px;
            color: white;
            font-family: "Poppins", sans-serif;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #ff6347;
            box-shadow: 0 0 0 3px rgba(255, 99, 71, 0.1);
            background: #222;
        }

        .form-group input.error,
        .form-group select.error,
        .form-group textarea.error {
            border-color: #ff3860;
            box-shadow: 0 0 0 3px rgba(255, 56, 96, 0.1);
        }

        .error-message {
            color: #ff3860;
            font-size: 0.85rem;
            margin-top: 5px;
            display: none;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .date-time-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .location-input-wrapper {
            position: relative;
        }

        .map-btn {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: #ff6347;
            border: none;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .map-btn:hover {
            background: #ff4500;
        }

        .submit-btn {
            background: linear-gradient(135deg, #ff6347, #ff4500);
            color: white;
            border: none;
            padding: 18px 30px;
            border-radius: 10px;
            font-family: "Poppins", sans-serif;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s ease;
            margin-top: 10px;
            box-shadow: 0 5px 15px rgba(255, 99, 71, 0.3);
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 99, 71, 0.4);
            background: linear-gradient(135deg, #ff4500, #ff6347);
        }

        .submit-btn:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Map Container */
        .map-container-wrapper {
            background: #2b2b2b;
            padding: 30px;
            border-radius: 20px;
            border: 1px solid #444;
        }

        .map-header {
            margin-bottom: 20px;
        }

        .map-header h3 {
            font-size: 1.5rem;
            color: white;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .map-header p {
            color: #ccc;
            font-size: 0.9rem;
        }

        #map {
            height: 500px;
            width: 100%;
            border-radius: 15px;
            border: 2px solid #444;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            transition: all 0.3s ease;
        }

        #map:hover {
            box-shadow: 0 15px 40px rgba(255, 99, 71, 0.2);
        }

        .map-controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .map-control-btn {
            background: #444;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-family: "Poppins", sans-serif;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .map-control-btn:hover {
            background: #ff6347;
        }

        .map-control-btn.active {
            background: #ff6347;
        }

        .route-info {
            background: #333;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            display: none;
        }

        .route-info.show {
            display: block;
        }

        .route-info h4 {
            color: #ff6347;
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .route-details {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 15px;
        }

        .route-detail-item {
            flex: 1;
            min-width: 150px;
        }

        .route-detail-item label {
            color: #999;
            font-size: 0.85rem;
            display: block;
            margin-bottom: 5px;
        }

        .route-detail-item span {
            color: white;
            font-size: 1.1rem;
            font-weight: 600;
        }

        /* Success Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: #2b2b2b;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 500px;
            width: 90%;
            border: 2px solid #ff6347;
        }

        .modal-icon {
            font-size: 4rem;
            color: #ff6347;
            margin-bottom: 20px;
        }

        .modal h3 {
            font-size: 1.8rem;
            margin-bottom: 15px;
            color: white;
        }

        .modal p {
            color: #ccc;
            margin-bottom: 25px;
            line-height: 1.6;
        }

        .modal-btn {
            background: #ff6347;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-family: "Poppins", sans-serif;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .modal-btn:hover {
            background: #ff4500;
            transform: translateY(-2px);
        }

        /* Toast Notification */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .toast {
            background: #2b2b2b;
            color: white;
            padding: 16px 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            border-left: 4px solid #ff6347;
            display: flex;
            align-items: center;
            gap: 12px;
            max-width: 350px;
            transform: translateX(400px);
            opacity: 0;
            transition: all 0.3s ease;
        }

        .toast.show {
            transform: translateX(0);
            opacity: 1;
        }

        .toast.hide {
            transform: translateX(400px);
            opacity: 0;
        }

        .toast-icon {
            font-size: 1.5rem;
            color: #ff6347;
        }

        .toast-content {
            flex: 1;
        }

        .toast-title {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .toast-message {
            font-size: 0.9rem;
            color: #ccc;
        }

        .toast-close {
            background: none;
            border: none;
            color: #ccc;
            cursor: pointer;
            font-size: 1.2rem;
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: all 0.2s ease;
        }

        .toast-close:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        /* Leaflet Custom Styles */
        .leaflet-popup-content-wrapper {
            background: #2b2b2b;
            color: white;
            border-radius: 10px;
        }

        .leaflet-popup-tip {
            background: #2b2b2b;
        }

        .leaflet-control-geocoder {
            background: #2b2b2b;
            border: 2px solid #444;
        }

        .leaflet-control-geocoder input {
            background: #1a1a1a;
            color: white;
            border: 1px solid #444;
        }

        .leaflet-routing-container {
            background: #2b2b2b;
            color: white;
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .booking-container {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .booking-hero h1 {
                font-size: 2.2rem;
            }

            .booking-form-container,
            .map-container-wrapper {
                padding: 25px 20px;
            }

            .form-row,
            .date-time-row {
                grid-template-columns: 1fr;
            }

            #map {
                height: 400px;
            }

            .route-details {
                flex-direction: column;
            }

            .map-controls {
                justify-content: center;
            }
        }

        @media (max-width: 480px) {
            .booking-hero h1 {
                font-size: 1.8rem;
            }

            #map {
                height: 350px;
            }

            .toast-container {
                top: 10px;
                right: 10px;
                left: 10px;
            }

            .toast {
                max-width: 100%;
            }
        }

        /* Animation */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in {
            animation: fadeInUp 0.6s ease forwards;
        }

        @keyframes shake {
            0%, 100% {
                transform: translateX(0);
            }
            25% {
                transform: translateX(-5px);
            }
            75% {
                transform: translateX(5px);
            }
        }

        .shake {
            animation: shake 0.5s ease-in-out;
        }
    </style>
</head>

<body>
    <!-- Hero Section -->
    <section class="booking-hero">
        <div class="container">
            <h1 class="fade-in">Book Your Vehicle Transport</h1>
            <p class="fade-in">Quick, secure, and reliable vehicle transportation booking with interactive map</p>
        </div>
    </section>

    <!-- Booking Section -->
    <section class="booking-section">
        <div class="container">
            <div class="booking-container">
                <!-- Booking Form -->
                <div class="booking-form-container fade-in">
                    <div class="form-header">
                        <h2>Transportation Details</h2>
                        <p>Fill in your vehicle and transport requirements</p>
                    </div>
                    <form class="booking-form" id="bookingForm">
                        <!-- Personal Information -->
                        <div class="form-row">
                            <div class="form-group">
                                <label for="fullName"><i class="fas fa-user"></i> Full Name *</label>
                                <input type="text" id="fullName" name="fullName" required
                                    placeholder="Enter your full name">
                                <div class="error-message" id="nameError">Please enter your full name</div>
                            </div>
                            <div class="form-group">
                                <label for="phone"><i class="fas fa-phone"></i> Phone Number *</label>
                                <input type="tel" id="phone" name="phone" required placeholder="Enter 10-digit number">
                                <div class="error-message" id="phoneError">Please enter a valid 10-digit phone number
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="email"><i class="fas fa-envelope"></i> Email Address *</label>
                            <input type="email" id="email" name="email" required placeholder="Enter your email">
                            <div class="error-message" id="emailError">Please enter a valid email address</div>
                        </div>

                        <!-- Vehicle Information -->
                        <div class="form-row">
                            <div class="form-group">
                                <label for="vehicleType"><i class="fas fa-car"></i> Vehicle Type *</label>
                                <select id="vehicleType" name="vehicleType" required>
                                    <option value="">Select Vehicle Type</option>
                                    <option value="hatchback">Hatchback</option>
                                    <option value="sedan">Sedan</option>
                                    <option value="suv">SUV</option>
                                    <option value="luxury">Luxury Car</option>
                                    <option value="bike">Motorcycle</option>
                                    <option value="commercial">Commercial Vehicle</option>
                                </select>
                                <div class="error-message" id="vehicleError">Please select vehicle type</div>
                            </div>
                            <div class="form-group">
                                <label for="vehicleModel"><i class="fas fa-cog"></i> Vehicle Model</label>
                                <input type="text" id="vehicleModel" name="vehicleModel"
                                    placeholder="e.g., Hyundai Creta">
                            </div>
                        </div>

                        <!-- Location Information -->
                        <div class="form-group">
                            <label for="pickupLocation"><i class="fas fa-map-marker-alt"></i> Pickup Location *</label>
                            <div class="location-input-wrapper">
                                <input type="text" id="pickupLocation" name="pickupLocation" required
                                    placeholder="Enter pickup address or click map">
                                <button type="button" class="map-btn" onclick="selectPickupOnMap()">
                                    <i class="fas fa-map-marked-alt"></i>
                                </button>
                            </div>
                            <div class="error-message" id="pickupError">Please enter pickup location</div>
                        </div>

                        <div class="form-group">
                            <label for="dropLocation"><i class="fas fa-flag-checkered"></i> Drop Location *</label>
                            <div class="location-input-wrapper">
                                <input type="text" id="dropLocation" name="dropLocation" required
                                    placeholder="Enter drop address or click map">
                                <button type="button" class="map-btn" onclick="selectDropOnMap()">
                                    <i class="fas fa-map-marked-alt"></i>
                                </button>
                            </div>
                            <div class="error-message" id="dropError">Please enter drop location</div>
                        </div>

                        <!-- Date & Time -->
                        <div class="date-time-row">
                            <div class="form-group">
                                <label for="pickupDate"><i class="fas fa-calendar"></i> Preferred Pickup Date *</label>
                                <input type="date" id="pickupDate" name="pickupDate" required>
                                <div class="error-message" id="dateError">Please select pickup date</div>
                            </div>
                            <div class="form-group">
                                <label for="pickupTime"><i class="fas fa-clock"></i> Preferred Time</label>
                                <select id="pickupTime" name="pickupTime">
                                    <option value="any">Any Time</option>
                                    <option value="morning">Morning (8 AM - 12 PM)</option>
                                    <option value="afternoon">Afternoon (12 PM - 5 PM)</option>
                                    <option value="evening">Evening (5 PM - 8 PM)</option>
                                </select>
                            </div>
                        </div>

                        <!-- Additional Information -->
                        <div class="form-group">
                            <label for="additionalInfo"><i class="fas fa-comment"></i> Additional Information</label>
                            <textarea id="additionalInfo" name="additionalInfo"
                                placeholder="Any special requirements or instructions..." rows="3"></textarea>
                        </div>

                        <button type="submit" class="submit-btn" id="submitBtn">
                            <i class="fas fa-paper-plane"></i>
                            <span>Confirm Booking</span>
                        </button>
                    </form>
                </div>

                <!-- Map Section -->
                <div class="map-container-wrapper fade-in">
                    <div class="map-header">
                        <h3>
                            <i class="fas fa-map-marked-alt"></i>
                            Interactive Location Map
                        </h3>
                        <p>Click on the map to select pickup and drop-off locations, or use the search function</p>
                    </div>
                    
                    <div id="map"></div>
                    
                    <div class="map-controls">
                        <button class="map-control-btn" id="clearRouteBtn" onclick="clearRoute()">
                            <i class="fas fa-trash"></i> Clear Route
                        </button>
                        <button class="map-control-btn" id="centerMapBtn" onclick="centerMap()">
                            <i class="fas fa-crosshairs"></i> Center Map
                        </button>
                        <button class="map-control-btn" id="showRouteBtn" onclick="showRoute()">
                            <i class="fas fa-route"></i> Show Route
                        </button>
                    </div>

                    <div class="route-info" id="routeInfo">
                        <h4><i class="fas fa-info-circle"></i> Route Information</h4>
                        <div class="route-details">
                            <div class="route-detail-item">
                                <label>Distance</label>
                                <span id="routeDistance">-- km</span>
                            </div>
                            <div class="route-detail-item">
                                <label>Estimated Time</label>
                                <span id="routeTime">-- hours</span>
                            </div>
                            <div class="route-detail-item">
                                <label>Estimated Cost</label>
                                <span id="routeCost">₹ --</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Success Modal -->
    <div class="modal" id="successModal">
        <div class="modal-content">
            <div class="modal-icon">
                <i class="fas fa-check-circle"></i>
            </div>
            <h3>Booking Confirmed!</h3>
            <p>Thank you for choosing Harihar Car Carriers. Your booking has been successfully submitted.</p>
            <p><strong>Booking Reference: <span id="bookingRef">HC2024-001</span></strong></p>
            <button class="modal-btn" onclick="closeModal()">Close</button>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
            crossorigin=""></script>
    
    <!-- Leaflet Routing Machine -->
    <script src="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.js"></script>
    
    <!-- Leaflet Control Geocoder -->
    <script src="https://unpkg.com/leaflet-control-geocoder@2.4.0/dist/Control.Geocoder.js"></script>

    <script>
        // Global variables
        let map;
        let pickupMarker;
        let dropMarker;
        let routingControl;
        let pickupCoords = null;
        let dropCoords = null;
        let selectingPickup = false;
        let selectingDrop = false;

        // Initialize map
        function initMap() {
            // Create map centered on India
            map = L.map('map').setView([20.5937, 78.9629], 5);

            // Add OpenStreetMap tiles
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
                maxZoom: 19
            }).addTo(map);

            // Add geocoder (search) control
            const geocoder = L.Control.geocoder({
                defaultMarkGeocode: false,
                placeholder: 'Search location...',
                errorMessage: 'Location not found'
            })
            .on('markgeocode', function(e) {
                const latlng = e.geocode.center;
                map.setView(latlng, 13);
                
                if (selectingPickup) {
                    setPickupLocation(latlng.lat, latlng.lng, e.geocode.name);
                } else if (selectingDrop) {
                    setDropLocation(latlng.lat, latlng.lng, e.geocode.name);
                }
            })
            .addTo(map);

            // Add click event to map
            map.on('click', function(e) {
                if (selectingPickup) {
                    reverseGeocode(e.latlng.lat, e.latlng.lng, 'pickup');
                } else if (selectingDrop) {
                    reverseGeocode(e.latlng.lat, e.latlng.lng, 'drop');
                }
            });

            // Custom markers
            const pickupIcon = L.divIcon({
                html: '<i class="fas fa-map-marker-alt" style="color: #4CAF50; font-size: 32px;"></i>',
                className: 'custom-div-icon',
                iconSize: [32, 32],
                iconAnchor: [16, 32]
            });

            const dropIcon = L.divIcon({
                html: '<i class="fas fa-flag-checkered" style="color: #ff6347; font-size: 32px;"></i>',
                className: 'custom-div-icon',
                iconSize: [32, 32],
                iconAnchor: [16, 32]
            });
        }

        // Reverse geocoding
        function reverseGeocode(lat, lng, type) {
            fetch(`https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lng}&format=json`)
                .then(response => response.json())
                .then(data => {
                    const address = data.display_name;
                    if (type === 'pickup') {
                        setPickupLocation(lat, lng, address);
                    } else if (type === 'drop') {
                        setDropLocation(lat, lng, address);
                    }
                })
                .catch(error => {
                    console.error('Geocoding error:', error);
                    showToast('Error', 'Could not get address for this location', 'error', 3000);
                });
        }

        // Set pickup location
        function setPickupLocation(lat, lng, address) {
            pickupCoords = [lat, lng];
            
            if (pickupMarker) {
                map.removeLayer(pickupMarker);
            }

            const pickupIcon = L.divIcon({
                html: '<i class="fas fa-map-marker-alt" style="color: #4CAF50; font-size: 32px;"></i>',
                className: 'custom-div-icon',
                iconSize: [32, 32],
                iconAnchor: [16, 32]
            });

            pickupMarker = L.marker([lat, lng], {
                icon: pickupIcon,
                draggable: true
            }).addTo(map);

            pickupMarker.bindPopup('<b>Pickup Location</b><br>' + address).openPopup();
            
            pickupMarker.on('dragend', function(e) {
                const newPos = e.target.getLatLng();
                reverseGeocode(newPos.lat, newPos.lng, 'pickup');
            });

            document.getElementById('pickupLocation').value = address;
            selectingPickup = false;
            
            showToast('Success', 'Pickup location set!', 'success', 2000);
            
            if (dropCoords) {
                calculateRoute();
            }
        }

        // Set drop location
        function setDropLocation(lat, lng, address) {
            dropCoords = [lat, lng];
            
            if (dropMarker) {
                map.removeLayer(dropMarker);
            }

            const dropIcon = L.divIcon({
                html: '<i class="fas fa-flag-checkered" style="color: #ff6347; font-size: 32px;"></i>',
                className: 'custom-div-icon',
                iconSize: [32, 32],
                iconAnchor: [16, 32]
            });

            dropMarker = L.marker([lat, lng], {
                icon: dropIcon,
                draggable: true
            }).addTo(map);

            dropMarker.bindPopup('<b>Drop Location</b><br>' + address).openPopup();
            
            dropMarker.on('dragend', function(e) {
                const newPos = e.target.getLatLng();
                reverseGeocode(newPos.lat, newPos.lng, 'drop');
            });

            document.getElementById('dropLocation').value = address;
            selectingDrop = false;
            
            showToast('Success', 'Drop location set!', 'success', 2000);
            
            if (pickupCoords) {
                calculateRoute();
            }
        }

        // Select pickup on map
        function selectPickupOnMap() {
            selectingPickup = true;
            selectingDrop = false;
            showToast('Info', 'Click on the map to select pickup location', 'info', 3000);
        }

        // Select drop on map
        function selectDropOnMap() {
            selectingDrop = true;
            selectingPickup = false;
            showToast('Info', 'Click on the map to select drop location', 'info', 3000);
        }

        // Calculate and show route
        function calculateRoute() {
            if (!pickupCoords || !dropCoords) {
                showToast('Warning', 'Please select both pickup and drop locations', 'warning', 3000);
                return;
            }

            if (routingControl) {
                map.removeControl(routingControl);
            }

            routingControl = L.Routing.control({
                waypoints: [
                    L.latLng(pickupCoords[0], pickupCoords[1]),
                    L.latLng(dropCoords[0], dropCoords[1])
                ],
                routeWhileDragging: false,
                showAlternatives: false,
                lineOptions: {
                    styles: [{color: '#ff6347', opacity: 0.8, weight: 5}]
                },
                createMarker: function() { return null; }, // Don't create default markers
                addWaypoints: false
            }).addTo(map);

            routingControl.on('routesfound', function(e) {
                const route = e.routes[0];
                const distance = (route.summary.totalDistance / 1000).toFixed(2);
                const time = (route.summary.totalTime / 3600).toFixed(1);
                const cost = Math.round(distance * 15); // ₹15 per km estimate

                document.getElementById('routeDistance').textContent = distance + ' km';
                document.getElementById('routeTime').textContent = time + ' hours';
                document.getElementById('routeCost').textContent = '₹ ' + cost.toLocaleString();
                
                document.getElementById('routeInfo').classList.add('show');
                
                showToast('Route Found', `Distance: ${distance}km, Time: ${time}hrs`, 'success', 4000);
            });

            // Fit bounds to show entire route
            const bounds = L.latLngBounds([pickupCoords, dropCoords]);
            map.fitBounds(bounds, { padding: [50, 50] });
        }

        // Show route
        function showRoute() {
            calculateRoute();
        }

        // Clear route
        function clearRoute() {
            if (routingControl) {
                map.removeControl(routingControl);
                routingControl = null;
            }
            
            if (pickupMarker) {
                map.removeLayer(pickupMarker);
                pickupMarker = null;
            }
            
            if (dropMarker) {
                map.removeLayer(dropMarker);
                dropMarker = null;
            }
            
            pickupCoords = null;
            dropCoords = null;
            
            document.getElementById('pickupLocation').value = '';
            document.getElementById('dropLocation').value = '';
            document.getElementById('routeInfo').classList.remove('show');
            
            showToast('Cleared', 'Route and markers cleared', 'info', 2000);
        }

        // Center map
        function centerMap() {
            if (pickupCoords && dropCoords) {
                const bounds = L.latLngBounds([pickupCoords, dropCoords]);
                map.fitBounds(bounds, { padding: [50, 50] });
            } else {
                map.setView([20.5937, 78.9629], 5);
            }
        }

        // Toast Notification System
        function showToast(title, message, type = 'success', duration = 5000) {
            const toastContainer = document.getElementById('toastContainer');
            const toastId = 'toast-' + Date.now();

            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.id = toastId;

            let icon = 'fa-check-circle';
            if (type === 'error') icon = 'fa-exclamation-circle';
            if (type === 'warning') icon = 'fa-exclamation-triangle';
            if (type === 'info') icon = 'fa-info-circle';

            toast.innerHTML = `
                <div class="toast-icon">
                    <i class="fas ${icon}"></i>
                </div>
                <div class="toast-content">
                    <div class="toast-title">${title}</div>
                    <div class="toast-message">${message}</div>
                </div>
                <button class="toast-close" onclick="removeToast('${toastId}')">
                    <i class="fas fa-times"></i>
                </button>
            `;

            toastContainer.appendChild(toast);

            setTimeout(() => {
                toast.classList.add('show');
            }, 10);

            if (duration > 0) {
                setTimeout(() => {
                    removeToast(toastId);
                }, duration);
            }

            return toastId;
        }

        function removeToast(toastId) {
            const toast = document.getElementById(toastId);
            if (toast) {
                toast.classList.remove('show');
                toast.classList.add('hide');

                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                }, 300);
            }
        }

        // Form Validation and Submission
        document.addEventListener('DOMContentLoaded', function () {
            initMap();

            const bookingForm = document.getElementById('bookingForm');
            const submitBtn = document.getElementById('submitBtn');
            const successModal = document.getElementById('successModal');
            const bookingRef = document.getElementById('bookingRef');

            function generateBookingRef() {
                const prefix = 'HC2024';
                const randomNum = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
                return `${prefix}-${randomNum}`;
            }

            function validateName(name) {
                return name.trim().length >= 2;
            }

            function validatePhone(phone) {
                const phoneRegex = /^[6-9]\d{9}$/;
                return phoneRegex.test(phone.replace(/\D/g, ''));
            }

            function validateEmail(email) {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                return emailRegex.test(email);
            }

            function validateRequired(value) {
                return value.trim() !== '';
            }

            function showError(inputId, errorId, message) {
                const input = document.getElementById(inputId);
                const error = document.getElementById(errorId);

                input.classList.add('error', 'shake');
                error.textContent = message;
                error.style.display = 'block';

                setTimeout(() => {
                    input.classList.remove('shake');
                }, 500);
            }

            function hideError(inputId, errorId) {
                const input = document.getElementById(inputId);
                const error = document.getElementById(errorId);

                input.classList.remove('error');
                error.style.display = 'none';
            }

            const inputs = {
                fullName: validateName,
                phone: validatePhone,
                email: validateEmail,
                vehicleType: validateRequired,
                pickupLocation: validateRequired,
                dropLocation: validateRequired,
                pickupDate: validateRequired
            };

            Object.keys(inputs).forEach(field => {
                const input = document.getElementById(field);
                if (input) {
                    input.addEventListener('blur', function () {
                        const validator = inputs[field];
                        const errorId = field + 'Error';

                        if (!validator(this.value)) {
                            showError(field, errorId, getErrorMessage(field));
                        } else {
                            hideError(field, errorId);
                        }
                    });

                    input.addEventListener('input', function () {
                        hideError(field, field + 'Error');
                    });
                }
            });

            function getErrorMessage(field) {
                const messages = {
                    fullName: 'Please enter your full name (min 2 characters)',
                    phone: 'Please enter a valid 10-digit Indian phone number',
                    email: 'Please enter a valid email address',
                    vehicleType: 'Please select vehicle type',
                    pickupLocation: 'Please enter pickup location',
                    dropLocation: 'Please enter drop location',
                    pickupDate: 'Please select pickup date'
                };
                return messages[field] || 'This field is required';
            }

            bookingForm.addEventListener('submit', function (e) {
                e.preventDefault();

                let isValid = true;

                Object.keys(inputs).forEach(field => {
                    const input = document.getElementById(field);
                    const validator = inputs[field];
                    const errorId = field + 'Error';

                    if (!validator(input.value)) {
                        showError(field, errorId, getErrorMessage(field));
                        isValid = false;
                    }
                });

                if (isValid) {
                    submitBtn.disabled = true;
                    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i><span>Processing...</span>';

                    setTimeout(() => {
                        const reference = generateBookingRef();
                        bookingRef.textContent = reference;

                        showToast(
                            'Booking Confirmed!',
                            `Your booking reference is ${reference}. Our team will contact you shortly.`,
                            'success',
                            5000
                        );

                        successModal.style.display = 'flex';

                        bookingForm.reset();
                        clearRoute();

                        submitBtn.disabled = false;
                        submitBtn.innerHTML = '<i class="fas fa-paper-plane"></i><span>Confirm Booking</span>';
                    }, 2000);
                } else {
                    showToast(
                        'Form Validation Error',
                        'Please check all required fields and try again.',
                        'error',
                        5000
                    );
                }
            });

            const phoneInput = document.getElementById('phone');
            phoneInput.addEventListener('input', function (e) {
                let value = e.target.value.replace(/\D/g, '');
                if (value.length > 0) {
                    value = value.substring(0, 10);
                    if (value.length > 5) {
                        value = value.substring(0, 5) + ' ' + value.substring(5);
                    }
                }
                e.target.value = value;
            });

            const dateInput = document.getElementById('pickupDate');
            const today = new Date().toISOString().split('T')[0];
            dateInput.min = today;
        });

        function closeModal() {
            document.getElementById('successModal').style.display = 'none';
        }

        window.addEventListener('click', function (e) {
            const modal = document.getElementById('successModal');
            if (e.target === modal) {
                closeModal();
            }
        });
    </script>
</body>

</html>